# Tech Context: RoutineTrace

## Core Technologies

- **Runtime/Framework:** React Native with Expo
  - Expo SDK 53 is currently in use for accessing native device features and simplifying the development workflow.
- **Language:** TypeScript
- **Package Manager:** pnpm
  - Ensure `pnpm-lock.yaml` is committed and used for consistent dependency installation.
  - Use `pnpm install <package>` to add dependencies.
- **UI Library:** React Native Elements (`@rneui/themed`)
  - Components should be imported from `@rneui/themed`.
- **Navigation:** Expo Router
  - File-system based routing.
  - App structure includes drawer and tab navigation.
- **State Management (Server):** TanStack Query (FKA React Query)
  - For all asynchronous operations involving the Supabase backend.
  - Custom hooks should encapsulate query and mutation logic (e.g., `hooks/useTasksQueries.ts`).
- **State Management (Client - Global):** `react-native-async-storage/async-storage`
  - For simple global state that needs to persist across app sessions (e.g., settings, onboarding flags).
- **State Management (Client - Local/Context):** React Hooks (`useState`, `useContext`)
  - For component-level state and sharing state within specific component trees.
- **Forms:** TanStack Form
  - For building and managing forms, including validation and submission state.
- **Backend as a Service (BaaS):** Supabase
  - **Database:** PostgreSQL (schema defined in `.clinerules` and `projectbrief.md`).
  - **Authentication:** Supabase Auth for user management.
  - **Realtime (Optional):** Supabase offers realtime capabilities, which could be explored for features like live updates if needed.
- **Error Handling:**
  - **Neverthrow:** For synchronous and asynchronous operational success/failure modeling.
  - **Sentry:** Temporarily disabled. Will be re-enabled later.
  - `utils/reportError.ts`: Centralized utility for handling `Result` objects.
- **Type Definitions (Database):** `database.types.ts`
  - Generated by Supabase, provides TypeScript types for database tables and enums. Crucial for type-safe database interactions.
- **Documentation Lookup:** Context7
  - Used for fetching up-to-date documentation for libraries.
  - Context7 compatible library IDs are listed in `.clinerules`.

## Development Setup & Environment

- **Node.js & pnpm:** Required for running the project and managing dependencies.
- **Expo CLI:** For starting the development server (`pnpm start` or `expo start`), building the app, and other Expo-related tasks.
- **Emulator/Device:** An Android emulator or physical device is needed for running and testing the application.
- **Supabase Project:** A Supabase project must be set up with the defined database schema and authentication configured. Environment variables for Supabase URL and anon key will be required (typically in a `.env` file, managed by `utils/supabase.ts`).
- **Code Editor:** VS Code (implied by environment details).
- **Linting/Formatting:** ESLint (configured via `.eslintrc.js`). Prettier might also be in use (often integrated with ESLint). Auto-formatting on save is active.

## Technical Constraints & Considerations

- **Immutability:** Strictly enforce immutability for state and props.
- **Functional Components:** Exclusively use functional components and hooks. No class components.
- **`utils/supabase.ts`:** This file is critical for Supabase client initialization and should not be modified unless explicitly instructed for a core change.
- **Type Safety:** Leverage TypeScript and Supabase-generated types (`database.types.ts`) extensively.
- **Performance:** Be mindful of performance, especially with lists of tasks. Use `React.memo`, `useCallback`, and FlatList optimizations where appropriate. TanStack Query helps with caching to reduce redundant data fetching.
- **Offline Support:** Not explicitly required yet, but if it becomes a requirement, it will significantly impact state management and data synchronization strategies.
- **Security:**
  - Rely on Supabase for secure authentication and database interactions.
  - Ensure Row Level Security (RLS) policies are correctly implemented in Supabase to protect user data.
  - Be cautious with user input to prevent injection attacks (though Supabase client libraries generally handle this).

## Key Files & Directories (from initial file listing)

- **`.clinerules`:** Project-specific rules and context.
- **`app/`:** Contains all screen components and navigation setup (Expo Router).
  - `_layout.tsx`: Defines root layout, potentially including global providers.
  - `(drawer)/`: Drawer navigation screens.
  - `(tasks)/`: Task-related screens.
- **`components/`:** Reusable UI components.
- **`hooks/`:** Custom React hooks, especially for TanStack Query logic.
- **`utils/`:** Utility functions, including Supabase client setup, error reporting, date helpers, etc.
- **`schemas/`:** Likely contains Zod or Yup schemas for form validation with TanStack Form.
- **`theme/`:** Styling and theme configuration.
- **`database.types.ts`:** Supabase generated types.
- **`package.json`:** Project dependencies and scripts.
- **`tsconfig.json`:** TypeScript configuration.
- **`metro.config.js`, `app.json`, `eas.json`:** Expo and React Native configuration files.

## Tool Usage Patterns

- **Context7:**
  - Call `resolve-library-id` first to get the `context7CompatibleLibraryID`.
  - Then use `get-library-docs` with the ID and a specific topic.
  - Adjust `tokens` parameter (2k-10k) based on the required depth of documentation.
- **Supabase Client (`utils/supabase.ts`):**
  - All interactions with Supabase (DB queries, auth) go through the client instance initialized here.
- **TanStack Query Hooks:**
  - Define queries using `useQuery` and mutations using `useMutation`.
  - Encapsulate these in custom hooks within the `hooks/` directory for reusability and separation of concerns.
- **Neverthrow:**
  - Wrap functions that might fail in `Result` or `ResultAsync`.
  - Use `ok()`, `err()`, `okAsync()`, `errAsync()` helpers.
  - Process results using methods like `.map()`, `.andThen()`, `.unwrapOr()`, or pattern matching.
