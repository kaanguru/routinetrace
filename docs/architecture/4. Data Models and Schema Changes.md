4. Data Models and Schema Changes
This section defines the new local data models required for the enhancement and the strategy for integrating them with the existing database schema.

New Data Models
The following WatermelonDB models will be created to mirror the existing Supabase tables.

Task
Purpose: Represents a single task or habit that the user wants to track. This is a core entity in the application.

Integration: This local model directly corresponds to the tasks table in the Supabase database.

Key Attributes:

id: (Local WatermelonDB ID)

supabase_id: string (The UUID from the Supabase tasks table, used for mapping)

title: string

notes: string

repeat_on_wk: string[] (Array of days_of_week strings)

repeat_frequency: number

repeat_period: string (repeat_period enum)

updated_at: number (Unix timestamp)

Relationships:

With New: Has many ChecklistItem records.

ChecklistItem
Purpose: Represents a sub-task or a single item within a larger task's checklist.

Integration: This local model directly corresponds to the checklistitems table in the Supabase database.

Key Attributes:

id: (Local WatermelonDB ID)

supabase_id: string (The UUID from the Supabase checklistitems table)

task_id: string (The supabase_id of the parent Task)

content: string

is_completed: boolean

updated_at: number (Unix timestamp)

Relationships:

With New: Belongs to one Task record.

Schema Integration Strategy
Database Changes Required:

The primary change is the addition of a new client-side WatermelonDB database. No changes will be made to the remote Supabase schema itself.

New Local Tables: tasks, checklistitems, health_and_happiness, task_completion_history.

New Local Columns: Each local table will include a supabase_id column to map to the remote record and will track its own created_at and updated_at timestamps.

Migration Strategy:

For a first-time user or fresh install, the strategy is a full initial pull. The application will fetch all existing records from Supabase and populate the local WatermelonDB tables.

For subsequent sessions, an incremental pull/push sync will be used based on updated_at timestamps.

Backward Compatibility:

The remote Supabase schema remains unchanged, ensuring that any other services (if they existed) would not be affected.

Client-side application logic must be updated to handle the new data flow. For example, any code relying on a record's ID must be aware of both the local WatermelonDB id and the remote supabase_id and use the correct one in the appropriate context.