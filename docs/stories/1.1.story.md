
# Story 1.1: Foundational User Authentication Setup

## Status: Completed

## Story

- **As a** new user,
    
- **I want** to be able to register for an account and log in,
    
- **so that** I can securely access the application and manage my routines.
    

## Acceptance Criteria (ACs)

1. A new user can successfully register for an account using an email and password.
    
2. A registered user can successfully log in with their credentials.
    
3. Upon successful login or registration, the user is navigated to the main application screen (e.g., a placeholder "Dashboard" screen).
    
4. User session information is handled, allowing the user to remain logged in across app restarts.
    
5. Basic error handling is implemented for authentication (e.g., invalid credentials, email already in use).
    
6. The authentication flow uses the Supabase Auth client for all interactions.
    

## Tasks / Subtasks

- [ ] **Task 1: Project Structure Setup** (AC: All)
    
    - [ ] Create the basic directory structure for `screens`, `components`, `hooks`, and `navigation` as per the architecture plan.
        
- [ ] **Task 2: Initial Navigation Setup** (AC: 3)
    
    - [ ] Configure Expo Router to handle basic navigation between a "Login" screen and a placeholder "Dashboard" screen.
        
- [ ] **Task 3: Create Authentication Screens** (AC: 1, 2)
    
    - [ ] Create a `LoginScreen.tsx` with email and password input fields and a "Login" button.
        
    - [ ] Create a `RegisterScreen.tsx` with email and password input fields and a "Register" button.
        
    - [ ] Both screens should use React Native Elements for UI components.
        
- [ ] **Task 4: Implement Authentication Logic Hook** (AC: 1, 2, 4, 5, 6)
    
    - [ ] Create a new custom hook `useAuth.ts`.
        
    - [ ] This hook will encapsulate all Supabase authentication logic.
        
    - [ ] Implement a `signUp(email, password)` function that returns a `ResultAsync` from `Neverthrow`.
        
    - [ ] Implement a `signIn(email, password)` function that returns a `ResultAsync`.
        
    - [ ] Implement a `signOut()` function.
        
    - [ ] Manage the user's session state.
        
- [ ] **Task 5: Integrate Auth Logic with Screens** (AC: 1, 2, 3, 5)
    
    - [ ] Connect the `LoginScreen` and `RegisterScreen` to the `useAuth` hook.
        
    - [ ] On successful login/registration, navigate the user to the dashboard.
        
    - [ ] Display appropriate error messages to the user upon failure.
        
- [ ] **Task 6: Unit and E2E Testing** (AC: All)
    
    - [ ] Write **Jest** unit tests for the `useAuth` hook to verify its logic.
        
    - [ ] Create a **Maestro** E2E test flow that signs up a new user and logs them in.
        

## Dev Notes

### Technical Guidance

- **Authentication Provider**: All authentication must be handled by the Supabase client initialized in `utils/supabase.ts`. Do not modify this file.
    
- **Error Handling**: All functions in the `useAuth` hook that interact with Supabase must return a `ResultAsync` object from the `Neverthrow` library, as per our architectural principles.
    
- **Database Types**: Use the Supabase generated types from `database.types.ts` for any user or session objects.
    
- **UI Components**: All UI elements on the login and registration screens must be from `@rneui/themed`.
    

### Testing

- **Unit Tests**: Use **Jest** to test the `useAuth` hook. Mock the Supabase client to test success and error cases for sign-up and sign-in logic.
    
- **E2E Tests**: Use **Maestro** to write a flow that automates the user registration and login process to ensure the full authentication loop is working.
    
