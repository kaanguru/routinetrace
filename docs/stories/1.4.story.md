# Story 1.4: Mark a Task as Complete

## Status: Draft

## Story

-   **As a** user,
-   **I want** to be able to mark a task as complete,
-   **so that** I can track my progress and know what I have accomplished.

## Acceptance Criteria (ACs)

1.  Each task item in the list has a tappable element (e.g., a checkbox).
2.  Tapping the checkbox marks the corresponding task as "complete".
3.  The UI of the completed task visually changes to indicate its completed status (e.g., strikethrough text).
4.  The completed state is persisted locally via Legend-State.
5.  The change in completion status works seamlessly when the device is offline.
6.  The checkbox and visual feedback are implemented using React Native Elements (`@rneui/themed`).

## Tasks / Subtasks

-   [ ] **Task 1: Update Task List Item Component** (AC: 1, 3, 6)
    -   [ ] Modify the `src/components/TaskList.tsx` component (or its child `ListItem`).
    -   [ ] Add a `@rneui/themed` `CheckBox` component to each task item.
    -   [ ] Apply a style (e.g., `textDecorationLine: 'line-through'`) to the task title when it is marked as complete.
-   [ ] **Task 2: Update Task Logic Hook** (AC: 2, 4)
    -   [ ] Add a new function `toggleTaskCompletion(taskId: string)` to the `useTasks.ts` custom hook.
    -   [ ] This function will find the specified task in the `tasks$` observable and update its `is_completed` property.
-   [ ] **Task 3: Connect UI to Logic** (AC: 1, 2)
    -   [ ] In the `TaskList` component, connect the `onPress` event of the `CheckBox` to the `toggleTaskCompletion` function from the `useTasks` hook.
    -   [ ] Ensure the checked status of the `CheckBox` reflects the `is_completed` property of the task.
-   [ ] **Task 4: Unit and E2E Testing** (AC: All)
    -   [ ] Write **Jest** unit tests for the `toggleTaskCompletion` function in the `useTasks` hook.
    -   [ ] Update the **Maestro** E2E test to include a flow for tapping a task's checkbox and verifying that the task's appearance changes to reflect its new completed state.

## Dev Notes

### Technical Guidance
* **Architecture Reference**: Continue to adhere strictly to the custom hook pattern. The `TaskList` component should only call the `toggleTaskCompletion` function from the `useTasks` hook and should not contain any state manipulation logic itself.
* **State Management**: The `toggleTaskCompletion` function should directly modify the `is_completed` field of the correct task within the global `tasks$` observable. Legend-State's reactivity will ensure the UI updates automatically, and its sync engine will handle persisting the change.
* **UI Feedback**: The visual change for a completed task should be immediate and obvious to the user, providing clear feedback on their action.

### Testing
* **Unit Tests**: For the `useTasks` hook, mock the `tasks$` observable with a sample task. Call the `toggleTaskCompletion` function and then assert that the `is_completed` property of the mocked task has been correctly updated.
* **E2E Tests**: The Maestro flow should find a specific task in the list, tap its checkbox, and then verify that the task now has the "completed" style applied to it (e.g., strikethrough text).
